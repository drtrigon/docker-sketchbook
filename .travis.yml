language: bash

sudo: false

env:
  global:
    - DOCKER=drtrigon/docker-arduino DOCKERTAG=ubuntu-14.04  # ARDUINO_VERSION=1.8.2
  matrix:
    #- BOARD="arduino:avr:uno"
    - BOARD="arduino:avr:nano:cpu=atmega328"

services:
  - docker

install:
  - docker pull $DOCKER:$DOCKERTAG ;

script:
  - docker images ;
  - docker run -t -d --name testing $DOCKER:$DOCKERTAG bin/bash ;
  - docker ps -l ;
  - docker exec -t testing apt-get install -y git binutils tree ;
  - docker exec -t testing git clone https://github.com/drtrigon/sketchbook.git ;
  - docker exec -t testing arduino --verify --board $BOARD --verbose --preserve-temp-files sketchbook/MultiWii_2_4/MultiWii/MultiWii.ino ;
  # Output post-verify info
  - docker exec -t testing /bin/bash -c 'export ELF_FILE=`find /tmp/ -name "MultiWii.ino.elf"`'; readelf -a $ELF_FILE ;
  - docker exec -t testing /bin/bash -c 'export ELF_FILE=`find /tmp/ -name "MultiWii.ino.elf"`; readelf -a $ELF_FILE' ;
  - docker exec -t testing /bin/bash -c 'export ELF_FILE=`find /tmp/ -name "MultiWii.ino.elf"`; readelf -a \$ELF_FILE' ;
  - docker exec -t testing strings -d `find /tmp/ -name "MultiWii.ino.elf"` ;
  - docker exec -t testing size `find /tmp/ -name "MultiWii.ino.elf"` ;
  - docker exec -t testing tree
  - docker stop testing ;
  - docker rm testing ;
  #- docker rmi $DOCKER:$DOCKERTAG
  #- docker images ;
  #- docker container ls ;
  - docker ps -l ;

notifications:
  email: false
